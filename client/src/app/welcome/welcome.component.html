<div class="container d-flex flex-column justify-content-center align-items-center min-vh-100">

  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center vh-100">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <span class="ms-3">Loading posts...</span>
  </div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mt-3">
    {{ errorMessage }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <!-- Create post button -->
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createPostModal">
    <i class="bi bi-pencil-square me-1"></i> Create Post
  </button>

  <!-- Create Post Modal -->
  <div class="modal fade" id="createPostModal" tabindex="-1" aria-labelledby="createPostModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createPostModalLabel">Create Post</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <label for="content" class="form-label">Content</label>
          <textarea class="form-control" id="content" rows="3" [(ngModel)]="postContent"></textarea>
        </div>
        <div>
          <label for="image" class="form-label">Image/Video</label>
          <input type="file" class="form-control" id="image" (change)="handleFileInput($event)" accept="image/*,video/*" multiple>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" (click)="createPost()">Create</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Posts list -->
  <div *ngIf="!isLoading && !errorMessage && posts.data.length > 0" class="w-100" style="max-width: 600px;">
    <div *ngFor="let post of posts.data" class="card mb-4">
      <div class="card-body">
        <div class="d-flex align-items-center mb-2">
          <img [src]="baseUrl + post.authorImageUrl" 
               alt="{{ post.authorName }} profile image"
               class="rounded-circle me-2"
               style="width: 40px; height: 40px; object-fit: cover;">
          <h5 class="mb-0">{{ post.authorName }}</h5>
          <div class="dropdown ms-auto">
            <a
              class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
              href="#"
              [id]="'userDropdown' + post.id"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              (click)="$event.preventDefault()"
            >
             <p class="mb-0 fw-bold text-body pe-2 ">...</p>
            </a>

            <ul class="dropdown-menu dropdown-menu-end text-small shadow" [attr.aria-labelledby]="'userDropdown' + post.id">
              <li><a [routerLink]="['/main-layout/editPost' , post.id]" class="dropdown-item"><i class="bi bi-pencil-square me-1"></i> Edit Post</a></li>
              <li><hr class="dropdown-divider" /></li>
              <li><a (click)="deletePost(post.id)" class="dropdown-item text-danger">Delete</a></li>
            </ul>
          </div>
        </div>
        <p class="card-text">{{ post.content }}</p>
      </div>

      <!-- First post media (image/video) -->
      <img *ngIf="post.media && post.media.length > 0" [src]="baseUrl + post.media[0].url"
           class="card-img-top object-fit-cover" style="height: 180px" [alt]="post.authorName + ' post media'">

      <ul class="list-group list-group-flush">
        <li *ngFor="let comment of post.comments" class="list-group-item">
          <strong>{{ comment.authorName }}:</strong> {{ comment.content }}
          <br />
          <small class="text-muted">{{ comment.createdAt | date:'medium' }}</small>
        </li>
        <li *ngIf="!post.comments || post.comments.length === 0" class="list-group-item">
          No comments yet.
        </li>
      </ul>

      <div class="card-body d-flex justify-content-between">
        <a href="#" class="card-link" (click)="onLike(post); $event.preventDefault()">Like ({{ post.likes }})</a>
        <a href="#" class="card-link">Comment</a>
      </div>
    </div>
  </div>

  <!-- No posts message -->
  <div *ngIf="!isLoading && !errorMessage && posts.data.length === 0" class="alert alert-info mt-3 text-center">
    No posts found.
  </div>

  <!-- Pagination -->
  <nav *ngIf="posts.count > posts.pageSize" class="d-flex justify-content-center mt-4">
    <ngb-pagination
      [collectionSize]="posts.count"
      [page]="queryParams.pageIndex"
      [pageSize]="queryParams.pageSize"
      [maxSize]="5"
      [rotate]="true"
      [ellipses]="false"
      [boundaryLinks]="true"
      (pageChange)="onPageChange($event)">
    </ngb-pagination>
  </nav>

</div>
